
<h4 [ngStyle]="{'background-color': this.utilsSvc.getColor(valueThatChangesOnDataLoad)}" (click)="loadZooKeeperNodeData(pathToData)" class="text-center">
  <div class="row justify-content-center">
    <b [ngStyle]="{'color': this.utilsSvc.getColorForText()}" class=" my-h4" >{{utilsSvc.breadcrumbTitle(pathToData)}}</b>
  </div>
</h4>

<div *ngIf="valueThatChangesForSpinnerOnResponse" >
  <div class="row justify-content-center medium-paddingTop" >
    <mat-progress-spinner mode="indeterminate" strokeWidth="15"  [diameter]="150" [ngStyle]="{ margin: auto }"></mat-progress-spinner>
  </div>
</div>
<div *ngIf="!valueThatChangesForSpinnerOnResponse" >

  <!-----------Agent data runtime information---------------------------------------------------------------------------------------------------------------->

  <div *ngIf="this.utilsSvc.compareStrings(streamDataShowChoice, 'agentRuntime')" class="medium-marginLeftRight">

    <div class=" rounded-cornersBottom">

      <mat-form-field class="filterInputField" >
        <input matInput (keyup)="applyFilterRuntime($event.target.value)" placeholder="Filter">
      </mat-form-field>

      <mat-table mat-table [dataSource]="dataSourceRuntime"  matSort #matServiceAgentSort="matSort" (matSortChange)="sortData($event)" matSortActive="name" matSortDirection="asc"  class="agentRuntimeInformationTable">

        <!-- Name Column -->
        <ng-container matColumnDef="name" class="agentRuntimeTable">
          <mat-header-cell *matHeaderCellDef mat-sort-header [ngStyle]="{
          'background-color': this.utilsSvc.getColorInnerLabels(),
          'color': this.utilsSvc.getColorTableLabels()
          }"  class="agentRuntimeServiceInformationTableHeader text-alignCenter"> Name </mat-header-cell>
          <mat-cell *matCellDef="let element" class="agentRuntimeServiceInformationTableHeader"> <span class="small-marginTop medium-fontSize"><b>{{element.name}}</b></span> </mat-cell>
        </ng-container>

        <!-- Value Column -->
        <ng-container matColumnDef="value">
          <mat-header-cell *matHeaderCellDef mat-sort-header [ngStyle]="{
          'background-color': this.utilsSvc.getColorInnerLabels(),
          'color': this.utilsSvc.getColorTableLabels()
          }"  class="agentRuntimeServiceInformationTableHeader text-alignCenter" style="padding-left: 15px !important;"> Value </mat-header-cell>
          <mat-cell *matCellDef="let element" class="agentRuntimeTable display-inlineBlock fullWidth "  style="padding-left: 0px !important;"> <h6 class="small-marginTop">
            <div  *ngFor="let item of element.value | keyvalue">
              <div class="medium-fontSize noPadding">
                <div class="d-inline-block col-12 col-sm-4" ><h6 align="left" class="medium-fontSize" ><b>{{item.key}} </b></h6></div>
                <div class="d-inline-block col-12 col-sm-8"><h6 align="left" class="medium-fontSize">{{item.value}} </h6></div>
              </div>

            </div>
          </h6> </mat-cell>
        </ng-container>



        <mat-header-row *matHeaderRowDef="displayedColumns" style="color: #FFFFFF"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
      </mat-table>

      <mat-paginator #paginatorRuntime
                     [pageSize]="5"
                     [pageSizeOptions]="[5, 10, 20]" style="background-color: #E6E6E6;" class="agentRuntimeInformationPagginator rounded-cornersBottom">
      </mat-paginator>
    </div>
  </div>

  <!-----------Agent data : services in agent list---------------------------------------------------------------------------------------------------------------->

  <div *ngIf="this.utilsSvc.compareStrings(streamDataShowChoice, 'agent')"  class="medium-marginLeftRight">

    <div class="rounded-cornersBottom">

      <mat-form-field class="filterInputField" >
        <input matInput (keyup)="applyFilterService($event.target.value)" placeholder="Filter">
      </mat-form-field>

      <mat-table [dataSource]="dataSourceService" matSort #matServiceSort="matSort"  multiTemplateDataRows >

        <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplay">
          <mat-header-cell  *matHeaderCellDef mat-sort-header  [ngStyle]="{
          'background-color': this.utilsSvc.getColorInnerLabels(),
          'color': this.utilsSvc.getColorTableLabels()
          }"   class="agentRuntimeServiceInformationTableHeader text-alignCenter"> {{serviceTableLabels[column]}} </mat-header-cell>
          <mat-cell  *matCellDef="let element" class="align-alignEnd">

            <span class="mobile-label" style="margin-right: 1.4em;">  {{column}} :</span>
            <div *ngIf="this.utilsSvc.compareStrings(column, 'Stream')">

              <div class="row  align-items-center small-marginRight" >
                <div routerLink="{{element[column]}}" >
                  <span class=" display-inlineFlex routing">
                    <h6><b>{{element[column]}}</b>
                      <div *ngIf="iconsRegistered.includes('/'+pathToData)" class="display-inline">
                        <mat-icon  svgIcon="{{'/'+pathToData+'/'+element[column]}}" class="serviceIcon"></mat-icon>
                      </div>
                    </h6>
                 </span>
                </div>
                <svg width="24" height="24" viewBox="0 0 24 24" style=" cursor: pointer;" >
                  <title>Expand</title>
                  <path d="M9 3L5 6.99h3V14h2V6.99h3L9 3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99h-3z"/>
                  <path d="M0 0h24v24H0z" fill="none"/>
                </svg>
              </div>
            </div>
            <div *ngIf="this.utilsSvc.compareStrings(column, 'control') && !this.utilsSvc.compareStrings(serviceControlList[element.Stream], 'undefined')" class="small-marginTop">
              <div class="row mx-auto justify-content-center small-marginLeftRight">
                <div class="small-marginLeftRight rounded-corners display-content">
                  <div *ngIf="serviceControlList[element.Stream].includes('replay')"  class="display-inlineFlex">
                    <mat-form-field appearance="outline" (click)="onEvent($event)">
                      <input matInput   type="number" placeholder="Item id" [(ngModel)]="blockNumber" />
                    </mat-form-field>
                    <svg class="background-svgColorChange" (click)="onEvent($event)" style="padding-bottom: 1px; cursor: pointer;" (click)="replayTheBlockFromInput(blockNumber)" height="22" width="22" viewBox="0 0 42 42" >
                      <title>Replay Item</title>
                      <path d="M0 0h48v48H0z" fill="none"/>
                      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"/>
                    </svg>
                  </div>
                  <div *ngIf="serviceControlList[element.Stream].includes('stop')" class="display-inlineFlex">
                    <svg class="background-svgColorChange" (click)="onEvent($event)" (click)="startStopStream(streamStartStop)" style="padding-bottom: 1px; cursor: pointer;" height="22" viewBox="0 0 46 46" width="22" xmlns="http://www.w3.org/2000/svg">
                      <title>Stop Stream</title>
                      <path d="M0 0h48v48H0z" fill="none"/>
                      <path d="M12 12h24v24H12z"/>
                    </svg>
                  </div>
                  <div *ngIf="serviceControlList[element.Stream].includes('start')" class="display-inlineFlex">
                    <svg class="background-svgColorChange" (click)="onEvent($event)"  (click)="startStopStream(streamStartStop)" style="padding-bottom: 1px; cursor: pointer;" height="22" viewBox="0 0 46 46" width="22" xmlns="http://www.w3.org/2000/svg">
                      <title>Start Stream</title>
                      <path d="M-838-2232H562v3600H-838z" fill="none"/>
                      <path d="M16 10v28l22-14z"/>
                      <path d="M0 0h48v48H0z" fill="none"/>
                    </svg>
                  </div>
                  <div *ngIf="serviceControlList[element.Stream].includes('pause')" class="display-inlineFlex">
                    <svg class="background-svgColorChange" (click)="onEvent($event)" style="padding-bottom: 1px; cursor: pointer;"  height="22" id="Layer_1" viewBox="0 0 512 512" width="22" xml:space="preserve" >
                    <title>Pause Stream</title>
                      <g>
                      <path d="M224,435.8V76.1c0-6.7-5.4-12.1-12.2-12.1h-71.6c-6.8,0-12.2,5.4-12.2,12.1v359.7c0,6.7,5.4,12.2,12.2,12.2h71.6   C218.6,448,224,442.6,224,435.8z"/>
                        <path d="M371.8,64h-71.6c-6.7,0-12.2,5.4-12.2,12.1v359.7c0,6.7,5.4,12.2,12.2,12.2h71.6c6.7,0,12.2-5.4,12.2-12.2V76.1   C384,69.4,378.6,64,371.8,64z"/>
                    </g>
                  </svg>
                  </div>
                </div>
              </div>

              <!--<app-service-control></app-service-control>-->
            </div>
            <div *ngIf="!this.utilsSvc.compareStrings(column, 'Stream') && !this.utilsSvc.compareStrings(column, 'control')" >
              <div >
                <h6> {{element[column]}}</h6>
              </div>
            </div>
          </mat-cell>
        </ng-container>

        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
        <ng-container matColumnDef="expandedDetail">
          <mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length"  class="element-detail" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
            <div class="row">
              <div class="col-12" style="display:contents;">
                <div *ngFor="let item1 of element.description | keyvalue"  style="padding:2em;">
                  <div ><span align="left" class="medium-fontSize"><b> {{item1.key}}</b> </span></div>
                  <div ><span align="right" class="medium-fontSize">{{item1.value}} </span></div>
                </div>
              </div>
            </div>
          </mat-cell>
        </ng-container>


        <mat-header-row *matHeaderRowDef="columnsToDisplay" ></mat-header-row>
        <mat-row *matRowDef="let element; columns: columnsToDisplay;"
                 (click)="expandedElement = expandedElement === element ? null : element"
                 [ngStyle]="{'background-color': this.utilsSvc.getColorAgentListService(childrenParentNodes, element['Stream'])}"
             [class.expand-detail-row]="expandedElement === element"
          >
        </mat-row>
        <mat-row *matRowDef="let row; columns: ['expandedDetail']" class="expand-detail-row"></mat-row>
      </mat-table>
      <mat-paginator #paginatorService
                     [pageSize]="5"
                     [pageSizeOptions]="[1, 3, 5, 10]" style="background-color: #E6E6E6;" class="agentRuntimeInformationPagginator rounded-cornersBottom">
      </mat-paginator>
    </div>
  </div>


  <!-----------Cluster data : agents inside cluster list---------------------------------------------------------------------------------------------------------------->

  <div *ngIf="this.utilsSvc.compareStrings(streamDataShowChoice, 'cluster')" class="medium-marginLeftRight">

      <mat-form-field class="filterInputField" >
        <input matInput (keyup)="applyFilterCluster($event.target.value)" placeholder="Filter">
      </mat-form-field>

      <mat-table mat-table [dataSource]="dataSourceCluster"  matSort #sortCluster="matSort" class="agentRuntimeInformationTable" [ngStyle]="{'background-color': this.utilsSvc.getColorBackground()}" >

        <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplayCluster">
          <mat-header-cell *matHeaderCellDef mat-sort-header [ngStyle]="{
          'background-color': this.utilsSvc.getColorInnerLabels(),
          'color': this.utilsSvc.getColorTableLabels()
          }" class="agentRuntimeServiceInformationTableHeader mat-Header text-alignCenter">
            <div [ngSwitch]="column">
              <div *ngSwitchCase="'AgentName'" class="small-paddingRight">{{column}}</div>
              <div *ngSwitchCase="'StreamName'" class="small-paddingLeftRight">{{column}}</div>
              <div *ngSwitchDefault>{{column}}</div>
            </div>
          </mat-header-cell>
          <mat-cell *matCellDef="let element"  class="extraSmall-paddingTopBottom  mat-cell-Clusters align-alignEnd" style="font-size: 1em"  [ngStyle]="{'background-color': this.utilsSvc.getColorFalseAgent((!healthyServices[element.AgentName+'/'+utilsSvc.getNodePathEnd(element.StreamName)] && utilsSvc.compareStrings('AgentName',column)))}">
            <div [ngSwitch]="column">
              <div *ngSwitchCase="'AgentName'"  routerLink="{{element[column]}}" class="mousePointer display-inlineFlex small-paddingRight routing">
                <span class="mobile-label small-marginRight" >  {{column}} : </span>
                <span class="medium-fontSize"><b>{{element[column]}}</b></span>
              </div>
              <div *ngSwitchCase="'StreamName'"  routerLink="{{element.AgentName+'/'+utilsSvc.getNodePathEnd(element[column])}}" class="mousePointer small-paddingLeftRight routing">
                <div  class="display-inlineFlex">
                  <span class="mobile-label small-marginRight">  {{column}} : </span>
                  <div *ngIf="iconsRegistered.includes('/'+element[column])" class="small-paddingRight">
                    <mat-icon svgIcon="{{'/'+element[column]}}" class="serviceIcon"></mat-icon>
                  </div>
                  <span class="medium-fontSize" style="padding-top:5px"><b>{{utilsSvc.getNodePathEnd(element[column])}}</b></span>
                </div>
              </div>
              <div *ngSwitchCase="'Status'" class="small-paddingRight">
                <div *ngIf="element[column]; then serviceWorksBlock else serviceDoesNotWork"  class="small-paddingTop"></div>
                <ng-template #serviceWorksBlock >
                   <svg viewBox="0 0 50 50" height="24px" width="24px">
                     <title>Stream running</title>
                      <circle fill="#298A08" cx="24" cy="24" r="21"/>
                      <polygon fill="#CCFF90" points="34.6,14.6 21,28.2 15.4,22.6 12.6,25.4 21,33.8 37.4,17.4"/>
                   </svg>
                </ng-template>
                <ng-template #serviceDoesNotWork>
                  <svg viewBox="0 0 80 80" height="24px" width="24px" xml:space="preserve">
                    <title>No streaming data</title>
                    <path style="fill:#CD1F1F;" d="M36.22,0C16.212,0,0,16.216,0,36.227c0,19.999,16.212,36.214,36.22,36.214
                      c20.011,0,36.214-16.215,36.214-36.214C72.434,16.215,56.231,0,36.22,0z M52.058,46.82c1.379,1.424,0.953,4.078-0.959,5.932
                      c-1.911,1.854-4.577,2.209-5.959,0.785l-9.027-9.295l-9.298,9.027c-1.421,1.379-4.075,0.947-5.929-0.961s-2.206-4.574-0.785-5.956
                      l9.298-9.027l-9.027-9.298c-1.379-1.421-0.946-4.078,0.962-5.932c1.905-1.851,4.577-2.204,5.953-0.785l9.027,9.297l9.301-9.023
                      c1.424-1.382,4.078-0.95,5.929,0.958c1.857,1.908,2.206,4.577,0.785,5.959l-9.295,9.024L52.058,46.82z"/>
                  </svg>

                </ng-template>
              </div>
              <div *ngSwitchDefault class="display-inlineFlex">
                <span class="mobile-label small-marginRight" >  {{column}} : </span>
                <span class="medium-fontSize">{{element[column]}}</span>
              </div>
            </div>
          </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="columnsToDisplayCluster" ></mat-header-row>
        <mat-row *matRowDef="let row; columns: columnsToDisplayCluster;">
          {{row.ClusterName}}
        </mat-row>
      </mat-table>
      <mat-paginator #paginatorCluster
                     [pageSize]="10"
                     [pageSizeOptions]="[5, 10, 20]" style="background-color: #E6E6E6;" class="agentRuntimeInformationPagginator">
      </mat-paginator>
  </div>

  <!-----------Clusters list---------------------------------------------------------------------------------------------------------------->

  <div *ngIf="this.utilsSvc.compareStrings(streamDataShowChoice, 'clusters')" class="medium-marginLeftRight">
        <mat-form-field class="filterInputField" >
          <input matInput (keyup)="applyFilterClusters($event.target.value)" placeholder="Filter">
        </mat-form-field>
        <!-----------Clusters list cluster name - agent - dta1 data 2---------------------------------------------------------------------------------------------------------------->
        <mat-table mat-table [dataSource]="dataSourceClusters"  matSort #sortClusters="matSort" class="agentRuntimeInformationTable" [ngStyle]="{'background-color': this.utilsSvc.getColorBackground()}" >

          <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplayClusters">
            <mat-header-cell *matHeaderCellDef mat-sort-header [ngStyle]="{
          'background-color': this.utilsSvc.getColorInnerLabels(),
          'color': this.utilsSvc.getColorTableLabels()
          }" class="agentRuntimeServiceInformationTableHeader mat-Header text-alignCenter">
              <div [ngSwitch]="column">
                <div *ngSwitchCase="'ClusterName'" class="small-paddingLeftRight">{{column}}</div>
                <div *ngSwitchCase="'AgentName'" class="small-paddingRight">{{column}}</div>
                <div *ngSwitchDefault>{{column}}</div>
              </div>
            </mat-header-cell>
            <mat-cell *matCellDef="let element"  class="extraSmall-paddingTopBottom  mat-cell-Clusters" style="font-size: 1em"  [ngStyle]="{'background-color': this.utilsSvc.getColorFalseAgent((!healthyServices[element.ClusterName+'/'+utilsSvc.getNodePathEnd(element.AgentName)]&& utilsSvc.compareStrings('AgentName',column)))}">
              <div [ngSwitch]="column">
                <div *ngSwitchCase="'ClusterName'"  routerLink="{{element[column]}}" class="mousePointer display-inlineFlex small-paddingLeftRight routing">
                  <span class="mobile-label small-marginRight" >  {{column}} : </span>
                  <span class="medium-fontSize"><b>{{element[column]}}</b></span>
                </div>
                <div *ngSwitchCase="'AgentName'"  routerLink="{{'/'+element[column]}}" class="mousePointer small-paddingRight routing">
                  <div  class="display-inlineFlex">
                    <span class="mobile-label small-marginRight">  {{column}} : </span>
                    <div *ngIf="iconsRegistered.includes('/'+element[column])" class="small-paddingRight">
                      <mat-icon svgIcon="{{'/'+element[column]}}" class="serviceIcon"></mat-icon>
                    </div>
                    <span class="medium-fontSize" style="padding-top:5px"><b>{{utilsSvc.getNodePathEnd(element[column])}}</b></span>
                  </div>
                </div>
                <div *ngSwitchDefault class="display-inlineFlex">
                  <span class="mobile-label small-marginRight" >  {{column}} : </span>
                  <span class="medium-fontSize">{{element[column]}}</span>
                </div>
              </div>
            </mat-cell>


          </ng-container>

          <mat-header-row *matHeaderRowDef="columnsToDisplayClusters" ></mat-header-row>
          <mat-row *matRowDef="let row; columns: columnsToDisplayClusters;">
          </mat-row>
        </mat-table>
        <mat-paginator #paginatorClusters
                       [pageSize]="10"
                       [pageSizeOptions]="[5, 10 , 20]" style="background-color: #E6E6E6;" class="agentRuntimeInformationPagginator rounded-cornersBottom">
        </mat-paginator>
  </div>
</div>
